<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Initial Setup | UniAgent - Programming Drone Collectives</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="static/css/github-markdown-light.css">
<style>
	.markdown-body {
		box-sizing: border-box;
		min-width: 200px;
		max-width: 980px;
		margin: 0 auto;
		padding: 45px;
	}

	@media (max-width: 767px) {
		.markdown-body {
			padding: 15px;
		}
	}
</style>
  <style>
    a {
      color: #bf3ec3 !important;
    }
    .active {
        color: #bf3ec3 !important; /* Your custom active link color */
    }
    ul {
      list-style-type: square !important; 
      list-style-position: inside !important;
      margin-block-start: 0.2em !important;
      padding-inline-start: 1em !important;
    }
    </style>
</head>
<body class="flex h-screen">
<!-- Mobile menu toggle -->
<div class="fixed top-4 left-4 z-50">
    <button onclick="document.getElementById('mainSidebar').classList.toggle('hidden')" class="p-2 bg-gray-200 rounded shadow-lg">
      â˜°
    </button>
  </div>
  <!-- Sidebar -->
  <aside id="mainSidebar" class="w-1/4 bg-gray-100 p-4 overflow-auto sticky top-0 h-screen">
    <ul id="sidebar-list">
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/index">1. Overview</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer font-bold active">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/12-getting-started">2. Initial Setup</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/13-getting-started-cf.PyControl">3. Getting Started with the Crazyflie Controller</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/20-getting-started-simulation">4. Getting Started with Simulations</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/23-getting-started-webots-dscrazyflie">5. Webots Simulation (ds-crazyflie)</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/24-getting-started-gazebo-simcf2">6. Gazebo Simulation (sim_cf2)</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/31-methodology">7. Methodology</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/32-swarm-equations">8. Swarm Equations</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/51-tools">9. Tooling</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/52-x-terminal-layout">10. Terminal Layouts</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/82-further-resources">11. Further Resources</a>
              </li>
          
      
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6">
    <div class="p-4 border rounded-lg bg-white shadow prose max-w-none scroll-mt-20 markdown-body">
        <!-- <h1 id="title" class="scroll-mt-20">Initial Setup</h1> -->
        <div id="content" class="scroll-mt-20"><h1>Setup of the Crazyflie 2.x Environment</h1>
<p>First clone the following GitHub repository, which provides sort of a <strong>cyber-physical representation</strong> of the <strong>Crazyflie 2.x drone</strong>.</p>
<p>Therefore, execute the following command in the terminal:</p>
<pre class="codehilite"><code class="language-shell">$ mkdir -p ~/uniagent_ws/ &amp;&amp; cd ~/uniagent_ws/
$ git clone https://github.com/UniAgent-CyberPhysicalAssets/cps.asset.crazyflie
</code></pre>

<p>This resource is a prerequisite for all subsequent steps in this tutorial, including:</p>
<ul>
<li>Controlling and monitoring Crazyflies via RESTful web endpoints, WebSockets and in 3D</li>
<li>Using the Gazebo/Webots simulation environment for Crazyflie drones</li>
<li>Launching the cfclient tool to configure Crazyflie hardware</li>
<li>And more ...</li>
</ul>
<h3>System Hardware Requirements</h3>
<h4>Platform</h4>
<ul>
<li>The setup described in this tutorial does not work for <strong>arm64 platforms</strong> since not for all ROS2 packages, an arm64 binary is available.</li>
<li>For example, the package <code>ros-humble-gazebo-no-physics</code> is required, which has however no arm64 binary (see here: <a href="http://packages.ros.org/ros2/ubuntu/dists/jammy/main/binary-arm64/Packages">http://packages.ros.org/ros2/ubuntu/dists/jammy/main/binary-arm64/Packages</a>).</li>
</ul>
<h4>Enable GPU-accelerated Containers</h4>
<p>(Optional but Recommended)</p>
<ul>
<li>Install the <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">NVIDIA Container Toolkit</a></li>
</ul>
<h3>Convention</h3>
<p>Terminal commands are prefixed with either <code>$</code> or <code>:#</code>.
The former means that the command is executed in the <strong>host system</strong> (your computer).
The latter means that the command is executed in the <strong>Docker container</strong>.</p>
<p>Consider the <code>lsusb</code> command.
This should be executed inside the Docker container:</p>
<pre class="codehilite"><code class="language-shell">user@host: # lsusb
:# lsusb
</code></pre>

<p>This should be executed in the host system:</p>
<pre class="codehilite"><code class="language-shell">$ lsusb
</code></pre>

<p>If nothing is prefixed, this indicates output from the previous command.</p>
<h3>USB Setup</h3>
<blockquote>
<p><strong>Note:</strong> To control not only a virtual Crazyflie drone but also a real one, you need to make some USB devices such as the Crazyradio available in the Docker containers.</p>
</blockquote>
<p><strong>(ONLY for Linux)</strong> First, set the standard Crazyflie USB permissions: <a href="https://www.bitcraze.io/documentation/repository/crazyflie-lib-python/master/installation/usb_permissions/">https://www.bitcraze.io/documentation/repository/crazyflie-lib-python/master/installation/usb_permissions/</a></p>
<p>You will need to find out your major device number in order to access the USB devices within the Docker containers.
For background on why this setup is necessary, especially when avoiding the use of <code>--privileged</code>, see also <a href="https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/">here</a> and <a href="https://docs.docker.com/engine/containers/run/#runtime-privilege-and-linux-capabilities">here</a>.</p>
<p>There are three options:</p>
<ul>
<li><strong>Option A)</strong> Use the <code>lsusb</code> command to get a list of all USB devices connected to your system. Each line in the <code>lsusb</code> output represents a USB device with a Bus number and Device number.</li>
</ul>
<pre class="codehilite"><code class="language-shell">$ lsusb
[...]
Bus 001 Device 009: ID 1915:7777 Nordic Semiconductor ASA Bitcraze Crazyradio (PA) dongle
[...]
</code></pre>

<ul>
<li><strong>Option B)</strong> Use <code>udevadm</code> to get detailed information about the device, which includes the associated <code>/dev</code> entry. Below replace <code>001</code> with the Bus number and <code>009</code> with the Device number from the <code>lsusb</code> output. Specifically, use the output of <code>DEVNAME</code>.</li>
</ul>
<pre class="codehilite"><code class="language-shell">$ sudo udevadm info --query=all --name=/dev/bus/usb/001/009
[...]
U: usb
T: usb_device
D: c 189:262
N: bus/usb/001/009
[...]
</code></pre>

<ul>
<li><strong>Option C)</strong> Get device major number via <code>ls -la</code>using information from <code>DEVNAME</code></li>
</ul>
<pre class="codehilite"><code class="language-shell">$ ls -la /dev/bus/usb/001/009
crw-rw-r-- 1 root plugdev 189, 8 Aug  8 22:38 /dev/bus/usb/001/009
</code></pre>

<p>In the rest of this example:</p>
<ul>
<li>The major device number is in this example "189".</li>
</ul>
<p>(!) With this information, note down the following Docker parameter for later: (!)</p>
<pre class="codehilite"><code>--device-cgroup-rule='c 189:* rmw' -v /run/udev:/run/udev:ro -v /dev:/dev
</code></pre>

<p>You need to probably adjust the major device number or the path if you have a different device or operating system.</p>
<p>In the following pages, you have to add this rule when starting the Docker container.</p>
<blockquote>
<p><strong>Note:</strong> Instead, you can also use the universal but insecure option: <code>--privileged -v /dev/bus/usb:/dev/bus/usb</code>.</p>
</blockquote></div>
    </div>
  
    <!-- Bottom Navigation -->
    <div class="flex justify-between mt-4">
        
        <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/index" class="px-4 py-2 bg-blue-600 text-white rounded">
            Previous
        </a>
        
    
        
        <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/13-getting-started-cf.PyControl" class="px-4 py-2 bg-blue-600 text-white rounded">
            Next
        </a>
        
    </div>
  </main>
<script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
</body>
</html>
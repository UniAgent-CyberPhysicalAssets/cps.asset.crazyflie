<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Webots Simulation (ds-crazyflie) | UniAgent - Programming Drone Collectives</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="static/css/github-markdown-light.css">
<style>
	.markdown-body {
		box-sizing: border-box;
		min-width: 200px;
		max-width: 980px;
		margin: 0 auto;
		padding: 45px;
	}

	@media (max-width: 767px) {
		.markdown-body {
			padding: 15px;
		}
	}
</style>
  <style>
    a {
      color: #bf3ec3 !important;
    }
    .active {
        color: #bf3ec3 !important; /* Your custom active link color */
    }
    ul {
      list-style-type: square !important; 
      list-style-position: inside !important;
      margin-block-start: 0.2em !important;
      padding-inline-start: 1em !important;
    }
    </style>
</head>
<body class="flex h-screen">
<!-- Mobile menu toggle -->
<div class="fixed top-4 left-4 z-50">
    <button onclick="document.getElementById('mainSidebar').classList.toggle('hidden')" class="p-2 bg-gray-200 rounded shadow-lg">
      ☰
    </button>
  </div>
  <!-- Sidebar -->
  <aside id="mainSidebar" class="w-1/4 bg-gray-100 p-4 overflow-auto sticky top-0 h-screen">
    <ul id="sidebar-list">
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/index">1. Overview</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/12-getting-started">2. Initial Setup</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/13-getting-started-cf.PyControl">3. Getting Started with the Crazyflie Controller</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/20-getting-started-simulation">4. Getting Started with Simulations</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer font-bold active">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/23-getting-started-webots-dscrazyflie">5. Webots Simulation (ds-crazyflie)</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/24-getting-started-gazebo-simcf2">6. Gazebo Simulation (sim_cf2)</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/31-methodology">7. Methodology</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/32-swarm-equations">8. Swarm Equations</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/51-tools">9. Tooling</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/52-x-terminal-layout">10. Terminal Layouts</a>
              </li>
          
      
          
              <li class="sidebar-item p-2 cursor-pointer text-gray-600">
                  <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/82-further-resources">11. Further Resources</a>
              </li>
          
      
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6">
    <div class="p-4 border rounded-lg bg-white shadow prose max-w-none scroll-mt-20 markdown-body">
        <!-- <h1 id="title" class="scroll-mt-20">Webots Simulation (ds-crazyflie)</h1> -->
        <div id="content" class="scroll-mt-20"><h1>ds-crazyflie: Webots Simulation</h1>
<p><small>
<em>(This is a compilation of the most important features taken from the <a href="https://github.com/UniAgent-CyberPhysicalAssets/cps.asset.crazyflie/blob/main/simulation/ds-crazyflies-ext/Usage.md"><strong>Usage Guide</strong></a>.)</em>
</small></p>
<p><img src="static/images/webots-ds-crazyflies-screenshot.png" alt="Screenshot of Webots Simulation" style="zoom: 60%;" /></p>
<h2>Installation</h2>
<p>On your host system move into the root folder of the <strong>cps.asset.crazyflie</strong> GitHub project and execute the following commands:</p>
<pre class="codehilite"><code class="language-shell">$ cd ~/uniagent_ws/cps-asset/crazyflie2.x/simulation/ds-crazyflies-ext
$ chmod +x ./prepare.sh

# For Linux:
$ ./prepare.sh --linux

# For Windows:
$ ./prepare.sh
</code></pre>

<p>Then, build:</p>
<pre class="codehilite"><code class="language-shell">$ cd simulation.ds-crazyflies/docker/
$ sudo docker compose build
</code></pre>

<h2>Starting</h2>
<p>(For Linux) This allows to show the UI on the host system:</p>
<pre class="codehilite"><code class="language-shell">$ xhost +local:$USER 
</code></pre>

<h3>Workspace Setup</h3>
<p><strong>1. Terminal:</strong></p>
<p>Start all services:</p>
<pre class="codehilite"><code class="language-shell">$ cd ~/uniagent_ws/cps-asset/crazyflie2.x/simulation/ds-crazyflies-ext/simulation.ds-crazyflies/docker
$ sudo docker compose up
[+] up 1/1
 ✔ Container ds-crazyflies-dev Recreated             0.0s 
Attaching to ds-crazyflies-dev
</code></pre>

<p><strong>2. Terminal:</strong></p>
<p>Enter the container and start the simulation:</p>
<pre class="codehilite"><code class="language-shell">$ sudo docker exec -it ds-crazyflies-dev bash
:# webots /ds/crazywebotsworld/worlds/crazyflie.wbt --batch
</code></pre>

<p>To configure the world and number of Crazyflies:</p>
<pre class="codehilite"><code class="language-shell">:# nano /ds/crazywebotsworld/worlds/crazyflie.wbt
</code></pre>

<p><strong>3. Terminal:</strong></p>
<p>Enter the container and start the backend:</p>
<pre class="codehilite"><code class="language-shell">$ sudo docker exec -it ds-crazyflies-dev bash

:# ros2 launch crazyflies framework.launch.py backend:=webots
</code></pre>

<p><strong>4. Terminal:</strong></p>
<p>Enter the container:</p>
<pre class="codehilite"><code class="language-shell">$ sudo docker exec -it ds-crazyflies-dev bash
</code></pre>

<p>Then, for each Crazyflie in Webots execute (change ID):</p>
<pre class="codehilite"><code class="language-shell">:# ros2 service call /crazyflie_webots_gateway/add_crazyflie crazyflie_webots_gateway_interfaces/srv/WebotsCrazyflie &quot;id: 0&quot;

requester: making request: crazyflie_webots_gateway_interfaces.srv.WebotsCrazyflie_Request(id=0)
response:
crazyflie_webots_gateway_interfaces.srv.WebotsCrazyflie_Response(success=True, msg='')
</code></pre>

<p>The backend will report something like: <code>[gateway-1] [INFO] [1265723145.816038468] [cf0]: CrazyflieWebots node initialized.]</code></p>
<p><strong>5. Terminal:</strong></p>
<p>Start cf.PyControl for each virtual Webots instance:</p>
<ul>
<li>Make sure you have completed the <a href="13-getting-started-cf.PyControl">Getting Started Guide</a> for cf.PyControl.</li>
<li>Start the cf.PyControl Docker container</li>
<li>Then, execute:</li>
</ul>
<pre class="codehilite"><code class="language-shell">:# ./cfpyctrl.sh --dscf --cf-prefix /cf0 --port 5000 --wsendpoint --wsport 8765
</code></pre>

<p>For more drones:</p>
<pre class="codehilite"><code class="language-shell">:# ./cfpyctrl.sh --dscf --cf-prefix /cf1 --port 5001 --wsendpoint --wsport 8766
:# ./cfpyctrl.sh --dscf --cf-prefix /cf1 --port 5002 --wsendpoint --wsport 8767
[...]
</code></pre>

<h2>Usage</h2>
<h3>Controlling the Crazyflie</h3>
<p>Reuse terminal 4 or open a new terminal to control the Crazyflie using cf.PyControl in the usual way.</p>
<p>Example:</p>
<pre class="codehilite"><code class="language-shell">$ curl -d {} http://127.0.0.1:5000/activate_idle
$ curl -d {} http://127.0.0.1:5000/begin_takeoff
$ curl -d {} http://127.0.0.1:5000/navigate/1.0/1.0/0.5
$ curl -d {} http://127.0.0.1:5000/navigate/0.0/0.0/0.5
$ curl -d {} http://127.0.0.1:5000/begin_landing
</code></pre>

<h2>Troubleshooting</h2>
<h3>GUI not starting</h3>
<p><strong>Error:</strong></p>
<pre class="codehilite"><code class="language-shell">Authorization required, but no authorization protocol specified
Warning: could not connect to display :1
Warning: From 6.5.0, xcb-cursor0 or libxcb-cursor0 is needed to load the Qt xcb platform plugin.
Info: Could not load the Qt platform plugin &quot;xcb&quot; in &quot;&quot; even though it was found.
Fatal: This application failed to start because no Qt platform plugin could be initialized.
</code></pre>

<p><strong>Cause:</strong><br />
The container is not allowed to access the host X11 display.</p>
<p><strong>Fix</strong>: </p>
<ul>
<li><code>xhost +local:$USER</code></li>
<li>Restart the container and relaunch Webots.</li>
</ul></div>
    </div>
  
    <!-- Bottom Navigation -->
    <div class="flex justify-between mt-4">
        
        <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/20-getting-started-simulation" class="px-4 py-2 bg-blue-600 text-white rounded">
            Previous
        </a>
        
    
        
        <a href="https://uniagent-cyberphysicalassets.github.io/cps.asset.crazyflie/24-getting-started-gazebo-simcf2" class="px-4 py-2 bg-blue-600 text-white rounded">
            Next
        </a>
        
    </div>
  </main>
<script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
</body>
</html>